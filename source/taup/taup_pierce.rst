taup pierce
===========

:本节贡献者: |田冬冬|\（作者）、
             |姚家园|\（审稿）
:最近更新日期: 2021-06-05

----

``taup pierce`` 命令可用于计算震相在特定不连续面或指定深度处的穿透点信息
（包括走时、位置等）。

基本用法
--------

使用 ``taup pierce --help`` 可查询该命令的完整用法和选项。大多数选项的含义与
:doc:`taup_time` 相同，不再赘述。此处仅介绍常用用法。

计算震源深度为 300 km，震中距 48.44° 处 PcP 震相的穿透点信息::

    $ taup pierce -ph PcP -h 300 -deg 48.44
    > PcP at   573.47 seconds at    48.44 degrees for a    300.0 km deep source in the iasp91 model with rayParam    3.636 s/deg.
        0.00   300.0     0.0
        0.34   410.0    13.1
        1.25   660.0    40.4
       23.84  2889.0   267.1
       46.42   660.0   493.7
       47.33   410.0   521.0
       47.67   300.0   534.1
       47.92   210.0   545.2
       48.38    35.0   567.6
       48.41    20.0   570.0
       48.44     0.0   573.5

输出有三列，分别是射线在穿过地球主要间断面（如 410、660 不连续面、Moho 面和核幔边界）时的
震中距（度）、深度（km）和震相走时（s）。例如，由上面的输出可知，PcP 震相在
传播 267.1 秒后在核幔边界反射，此时反射点与震源的距离为 23.84 度。

获取穿透点地理位置
------------------

如果想知道震相在穿透某个深度时的具体地理位置（比如想知道 PcP 震相在核幔边界的反射点地理位置），
则需要提供地震和台站的地理位置信息。提供地震和台站地理位置信息的方式有多种：

- 使用 ``-sta`` 和 ``-evt`` 分别指定台站地理位置和地震地理位置
- 使用 ``-evt`` 和 ``-deg``/``-km`` 指定地震地理位置和震中距，并使用 ``-az`` 指定事件到台站的方位角
- 使用 ``-sta`` 和 ``-deg``/``-km`` 指定台站地理位置和震中距，并使用 ``-baz`` 指定事件到台站的方位角

假定地震位置为 (0°E,0°N)，台站位置为 (40°E,30°N)，震中距为 48.44°，反方位角为 48 度，方位角为 239°。
下面的示例展示了使用三种不同的方式计算 PcP 震相从地震到台站的穿透点地理位置::

    # 1. 使用 -sta 和 -evt
    $ taup pierce -ph PcP -evt 0 0 -sta 30 40

    # 2. 使用 -evt, -deg 和 -az
    $ taup pierce -ph PcP -evt 0 0 -deg 48.44 -az 239

    # 3. 使用 -st, -deg 和 -baz
    $ taup pierce -ph PcP -sta 30 40 -deg 48.44 -baz 48

以上三个命令的输出是相同的（存在可忽略的差异）。::

    > PcP at   610.07 seconds at    48.44 degrees for a      0.0 km deep source in the iasp91 model with rayParam    3.604 s/deg.
        0.00     0.0     0.0      0.00      0.00
        0.03    20.0     3.5      0.02      0.03
        0.06    35.0     5.9      0.04      0.05
        0.51   210.0    28.3      0.34      0.38
        1.10   410.0    52.4      0.73      0.81
        2.00   660.0    79.7      1.34      1.49
       24.22  2889.0   305.0     15.91     18.50
       46.44   660.0   530.4     28.96     38.03
       47.34   410.0   557.7     29.43     38.92
       47.93   210.0   581.8     29.74     39.49
       48.38    35.0   604.2     29.97     39.94
       48.40    20.0   606.6     29.98     39.97
       48.44     0.0   610.1     30.00     40.00

其中输出的 5 列分别是射线在穿过地球主要间断面时的，震中距（度）、深度（km）、
震相走时（s）、纬度和经度。

从输出中可以看出，PcP 震相在核幔边界的反射点位于 (15.91°N,18.50°S) 处。


.. TODO

获取反射点信息
--------------

TauP 中的穿透点分为两种，一种是真正意义上的穿透点（即射线穿过某一深度），
另一种是折返点（即射线在该深度处折返）。比如 PcP 在 660 界面上的点是穿透点，
在核幔边界上的点则是折返点。

折返点又分为两种，底部折返点（bottom turning points）和 底面（underside reflection points），
可以形象的表示为 ``v`` 和 ``^`` 。

获取 bottom turing points:

::

   $ taup_pierce -ph PKiKP -mod prem -h 200 -evt 0 0 -sta 15 15 -turn
   > PKiKP at 971.26 seconds at 21.09 degrees for a 200.0 km deep source in the prem model with rayParam 0.470 s/deg.
      10.51  5149.5   472.7      7.54      7.35

获取 underside reflection points（这里以 sScS 为例）:

::

   $ taup_pierce -ph sScS -mod prem -h 200 -evt 0 0 -sta 15 15 -under
   > sScS at  1020.00 seconds at    21.09 degrees for a    200.0 km deep source in the prem model with rayParam    3.495 s/deg.
       0.26     0.0    46.9      0.18      0.18
      21.09     0.0  1020.0     15.00     15.00

当然也可以用 ``-rev`` 选项获取所有反射点。

获取特定深度的穿透点位置
------------------------

默认只输出地球模型主要间断面处的穿透点信息，有些时候会需要震相在特定深度处的穿透点信息，比如深度为
5000km 处:

::

   $ taup_pierce -ph PKiKP -mod prem -h 200 -evt 0 0 -sta 15 15 -pierce 5000
   > PKiKP at   971.26 seconds at    21.09 degrees for a    200.0 km deep source in the prem model with rayParam    0.470 s/deg.
       0.00   200.0     0.0      0.00      0.00
       0.01   220.0     2.5      0.00      0.00
       0.07   400.0    23.1      0.05      0.05
       0.19   670.0    50.8      0.14      0.13
       2.40  2891.0   230.0      1.72      1.67
       9.06  5000.0   457.9      6.50      6.32
      10.51  5149.5   472.7      7.54      7.35
      11.97  5000.0   487.6      8.58      8.38
      18.63  2891.0   715.5     13.29     13.18
      20.84   670.0   894.7     14.82     14.81
      20.96   400.0   922.3     14.91     14.90
      21.02   220.0   943.0     14.95     14.95
      21.03   200.0   945.5     14.96     14.95
      21.08    24.4   967.3     15.00     15.00
      21.09    15.0   968.7     15.00     15.00
      21.09     0.0   971.3     15.00     15.00

在输出中多了两个 5000km
处的穿透点信息，有时候只想要这个深度的信息，而不需要其他深度的穿透点信息，此时可以使用
``-nodiscon`` 选项:

::

   $ taup_pierce -ph PKiKP -mod prem -h 200 -evt 0 0 -sta 15 15 -pierce 5000 -nodiscon
   > PKiKP at   971.26 seconds at    21.09 degrees for a    200.0 km deep source in the prem model with rayParam    0.470 s/deg.
       9.06  5000.0   457.9      6.50      6.32
      11.97  5000.0   487.6      8.58      8.38
