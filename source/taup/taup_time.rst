taup_time
=========

TauP 提供的 ``taup_time`` 命令可用于计算震相走时、射线参数、出射角、
入射角等信息。

基本用法
--------

使用 ``taup_time --help`` 可查询该命令的完整用法和选项，此处仅介绍最常用用法。

计算震源深度为 300 km，震中距 60° 处，P、S、PcP 等震相的走时信息::

   $ taup_time -ph P,S,PcP,ScS,PKiKP -deg 60 -h 300

-  ``-ph`` 指定了一系列以逗号分隔的震相名
-  ``-h`` 指定震源深度（单位 km）
-  ``-deg`` 指定震中距（单位为°）

TauP 默认使用 iasp91 模型，可以使用 ``-mod`` 选项设置要使用的速度模型::

   $ taup_time -ph P,S,PcP,ScS,PKiKP -deg 60 -h 300 -mod prem

在震中距比较小的情况下，可以使用 ``-km`` 选项指定震中距（单位为千米）。
比如计算一个浅源地震在 100 km 处常见 P 波震相的走时信息::

   $ taup_time -mod prem -ph P,S -h 2 -km 100

若已知震源和台站位置，也可以使用 ``-sta`` 和 ``-evt`` 分别指定台站和震源的
纬度和经度。例如，台站位于 (20°N,130°E)，震源位于 (40°N,150°E)，则::

   $ taup_time -mod prem -ph P,PcP -h 100 -sta 20 130 -evt 40 150

TauP 中默认台站位于地表处，也可使用 ``--stadepth`` 指定台站深度（单位为km）::

   $ taup_time -ph P,S,PcP,ScS,PKiKP -deg 60 -h 300 --stadepth 0.5

输出格式
--------

下面的命令计算了 PREM 模型下，震源深度 100 km，震中距 60° 处，P 和 pP 震相的走时信息。
其输出为::

   $ taup_time -mod prem -h 100 -deg 60 -ph pP,P

   Model: prem
   Distance   Depth   Phase   Travel    Ray Param  Takeoff  Incident  Purist    Purist
     (deg)     (km)   Name    Time (s)  p (s/deg)   (deg)    (deg)   Distance   Name
   -----------------------------------------------------------------------------------
      60.00   100.0   P        595.40     6.815     30.14    20.82    60.00   = P
      60.00   100.0   pP       618.89     6.890    149.49    21.06    60.00   = pP

输出共 9 列，从左到右分别为：

1. 震中距（度）
2. 震源深度（km）
3. 震相名
4. 震相走时（秒）
5. 射线参数（秒/度）
6. 出射角（度）：即射线从震源出射时与\ **垂直向下**\ 方向的夹角，取值范围为0到180°。

   - 出射角 0° 到 90° 内表示射线向下出射（例如P震相）
   - 出射角 90° 到 180° 内表示射线向上出射（例如pP震相)

7. 入射角（度）：射线在台站（位于地表）处入射时与垂直向上方向的夹角。应该是恒正的。
8. Purist Distance
9. Purist Name


.. note::

   射线参数的单位



关于射线参数

.. math::

    p = r \frac{\sin \theta}{v_s} = 6371 km \frac{\sin 20.82}{5.8 km/s}
      = 390.425 s/radian

.. math:: = 390.425 * 2\pi/360 s/deg = 6.815 s/deg

**老版本的TauP对出射角的定义稍有不同： 若夹角在 0 到 90
度内，则取正值；若夹角在 90 度到 180 度内，则先减去 90，再取负值。
因而，一般情况下，P 波出射者为正值，而 pP 出射角为负值。**

信息提取
--------

上面介绍的输出中包含了很多信息，想要在脚本中提取出想要的信息有些麻烦。所以
``taup_time`` 提供了一些选项，使得在脚本中计算走时什么的更加方便。

time
~~~~

该选项使得输出中只包含走时信息::

   $ taup_time -mod prem -ph P,S,PcP -deg 60 -h 100 --time
   595.3896 640.09875 1081.2472

需要注意的是，输出中走时不是按照 ``-ph``
选项中震相的顺序进行排序的，而是按照走时递增的顺序排序。比如这里，S
震相放在震相列表的第二位，而走时 1081.2472 却放在第三位。

rayp
~~~~

该选项使得输出中只包含射线参数信息::

   $ taup_time -mod prem -ph P,S,PcP -deg 60 -h 100 --rayp
   6.8185554 3.9990747 12.785722

这里，射线参数的输出是按照震相进行排序的。

time 和 rayp
~~~~~~~~~~~~

这两个选项是不能一起用的，也就是说不能同时输出震相走时和射线参数信息。当两个选项同时使用时，会以后出现的选项为准。

当同时需要走时和射线参数时，只能多次执行命令了。

rel
~~~

该选项用于计算震相的相对走时，似乎有 bug，无法正常工作。
